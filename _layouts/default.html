---
layout: compress
---

{% include base_path %}

<!doctype html>
<html lang="{{ site.locale | slice: 0,2 }}" class="no-js">
  <head>

  <link rel="icon" href="../images/upcite_logo.png" type="image/png">

	  <script src="https://www.google.com/analytics/js/ga.js"></script>
    
  <!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=300840089"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'G-VVHW2RQ1YW');
</script>


    <script>

      // 引入 Google API 客户端库
gapi.analytics.ready(function() {
  // 创建 Google Analytics 客户端对象
  var client = gapi.analytics.client.init({
    clientId: '139521967332-531u4q0cod4nl4s8p7ptd48f2fgse13k.apps.googleusercontent.com', // 您的 Google Analytics API 客户端 ID
  });

  // 获取页面浏览次数
  client.query({
    ids: 'ga:YOUR-VIEW-ID', // 您的 Google Analytics 视图 ID
    metrics: 'ga:pageviews'
  }).then(function(response) {
    var pageviews = response.totalResults ? response.rows[0][0] : '0';
    // 在网页上显示浏览次数
    document.getElementById('pageviews').textContent = '浏览次数：' + pageviews;
  });
});
      
    </script>


<script>

	const { google } = require('googleapis');
const key = require('./client_secret_139521967332-531u4q0cod4nl4s8p7ptd48f2fgse13k.apps.googleusercontent.com.json'); // 替换为您的服务帐户凭据文件路径

// 设置身份验证凭据
const jwtClient = new google.auth.JWT(
  key.client_email,
  null,
  key.private_key,
  ['https://www.googleapis.com/auth/analytics.readonly'],
);

// 创建 Google Analytics Reporting API 客户端
const analyticsreporting = google.analyticsreporting('v4');

// 设置请求参数
const request = {
  reportRequests: [
    {
      viewId: 'ga:G-VVHW2RQ1YW', // 替换为您的 GA4 测量 ID
      dateRanges: [{ startDate: '7daysAgo', endDate: 'today' }], // 指定日期范围（七天内）
      metrics: [{ expression: 'ga:pageviews' }], // 检索页面浏览次数
    },
  ],
};

// 发送 API 请求
jwtClient.authorize(function (err, tokens) {
  if (err) {
    console.error('API 认证失败', err);
    return;
  }

  analyticsreporting.reports.batchGet(
    {
      auth: jwtClient,
      resource: request,
    },
    function (err, response) {
      if (err) {
        console.error('API 请求失败', err);
        return;
      }

      const report = response.data.reports[0];
      const pageviews = report.data.totals[0].values[0];
      console.log('七日内总浏览次数：', pageviews);
    }
  );
});
	
</script>
	  
    
    {% include head.html %}
    {% include head/custom.html %}
  </head>

  <body>
    
    {% include browser-upgrade.html %}
    {% include masthead.html %}

    {{ content }}


    <div class="page__footer">
      <footer>
        {% include footer/custom.html %}

        
<div id="totalPageViews">总浏览次数：加载中...</div>
       
      
        <script>
  // 获取 Google Analytics 数据
  function getVisitCount() {
    gtag('event', 'page_view', {
      'send_to': 'G-VVHW2RQ1YW',
      'event_callback': function() {
        // 获取页面访问次数
        var visitCount = ga.getAll()[0].get('pageviews');
        
        // 将访问次数显示在页面上
        document.getElementById('visit-count').textContent = '访问次数：' + visitCount;
      }
    });
  }
  
  // 调用获取访问次数函数
  getVisitCount();
</script>


	      <script>
  // 使用 Google Analytics 4 API 查询事件数据
  gtag('event', 'page_view', {
    'send_to': 'G-VVHW2RQ1YW',
    'event_category': 'Page Views',
    'event_label': 'Total Page Views'
  });

  // 显示数据在网页上
  gtag('config', 'G-VVHW2RQ1YW', {
    'page_title': 'Total Page Views',
    'page_location': window.location.href
  });
</script>

        
        {% include footer.html %}
      </footer>
    </div>

    {% include scripts.html %}

  </body>
</html>
